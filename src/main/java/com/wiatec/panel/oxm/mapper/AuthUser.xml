<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wiatec.panel.oxm.dao.AuthUserDao">
    <resultMap type="com.wiatec.panel.oxm.pojo.AuthUserInfo" id="authUserInfo">
        <id column="id" property="id"/>
        <result column="username" property="username"/>
        <result column="password" property="password"/>
        <result column="email" property="email"/>
        <result column="phone" property="phone"/>
        <result column="first_name" property="firstName"/>
        <result column="last_name" property="lastName"/>
        <result column="level" property="level"/>
        <result column="email_status" property="emailStatus"/>
        <result column="mac" property="mac"/>
        <result column="country" property="country"/>
        <result column="region" property="region"/>
        <result column="city" property="city"/>
        <result column="time_zone" property="timeZone"/>
        <result column="token" property="token"/>
        <result column="active_time" property="activeDate"/>
        <result column="memberDateDate" property="memberDateDate"/>
        <result column="last_online_time" property="lastOnLineTime"/>
        <result column="create_time" property="createTime"/>
        <result column="modify_time" property="modifyTime"/>
    </resultMap>

    <select id="countByUsername" parameterType="com.wiatec.panel.oxm.pojo.AuthUserInfo" resultType="int">
        SELECT COUNT(*)
        FROM auth_user
        WHERE username=#{username}
    </select>

    <select id="countByMac" parameterType="com.wiatec.panel.oxm.pojo.AuthUserInfo" resultType="int">
        SELECT COUNT(*)
        FROM auth_user
        WHERE mac=#{mac}
    </select>

    <select id="countByEmail" parameterType="com.wiatec.panel.oxm.pojo.AuthUserInfo" resultType="int">
        SELECT COUNT(*)
        FROM auth_user
        WHERE email=#{email}
    </select>

    <insert id="saveOneUser" parameterType="com.wiatec.panel.oxm.pojo.AuthUserInfo">
        INSERT INTO auth_user (username, password, email, phone, first_name, last_name, mac,
                               token)
                VALUES (#{username}, #{password}, #{email}, #{phone}, #{firstName}, #{lastName},
                #{mac}, #{token})
    </insert>

    <select id="countByToken" parameterType="com.wiatec.panel.oxm.pojo.AuthUserInfo" resultType="int">
        SELECT COUNT(*)
        FROM auth_user
        WHERE token=#{token}
    </select>

    <update id="updateEmailStatus" parameterType="com.wiatec.panel.oxm.pojo.AuthUserInfo">
        UPDATE auth_user
        SET email_status=1, active_time=current_timestamp
        WHERE token=#{token}
    </update>

    <select id="countByUsernameAndPassword" parameterType="com.wiatec.panel.oxm.pojo.AuthUserInfo" resultType="int">
        SELECT COUNT(*)
        FROM auth_user
        WHERE username=#{username} AND password=#{password}
    </select>

    <update id="updateLocation" parameterType="com.wiatec.panel.oxm.pojo.AuthUserInfo">
        UPDATE auth_user
        SET country=#{country}, region=#{region}, city=#{city}, time_zone=#{timeZone},
            last_online_time=current_timestamp
        WHERE username=#{username}
    </update>

</mapper>